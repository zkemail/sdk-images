syntax = "proto3";

import "google/protobuf/timestamp.proto";

option go_package = "github.com/zkemail/conductor/pkg/pb/proto";

package blueprint;

enum ZkFramework {
    ZkFrameworkNone = 0;
    circom = 1;
    sp1 = 2;
    noir = 3;
}

enum BlueprintStatus {
    // Default value. If status is not set, we can use this to skip filtering for status.
    None = 0;
    Draft = 1;
    InProgress = 2;
    Done = 3; // i.e. circuits are compiled
    Failed = 4;
}

message Blueprint {
    string id = 1;
    string title = 2;
    string description = 3;
    string slug = 4;
    repeated string tags = 5;
    string email_query = 6;
    string circuit_name = 7;
    bool ignore_body_hash_check = 8;
    string sha_precompute_selector = 9;
    int32 email_body_max_length = 10;
    string sender_domain = 11;
    bool enable_header_masking = 12;
    bool enable_body_masking = 13;
    ZkFramework client_zk_framework = 14;
    ZkFramework server_zk_framework = 15;
    int32 verifier_contract_chain = 16;
    string verifier_contract_address = 17;
    bool is_public = 18;
    google.protobuf.Timestamp created_at = 19;
    google.protobuf.Timestamp updated_at = 20;
    repeated ExternalInput external_inputs = 21;
    repeated DecomposedRegex decomposed_regexes = 22;
    BlueprintStatus client_status = 23;
    BlueprintStatus server_status = 24;
    int32 version = 25;
    string github_username = 26;
    int32 email_header_max_length = 27;
    bool remove_soft_linebreaks = 28;
    int32 stars = 29;
    int32 ptau = 30;
    int32 num_local_proofs = 31;
    string internal_version = 32;
}

message ExternalInput {
    string name = 1;
    int32 max_length = 2;
}

message DecomposedRegex {
    string name = 1;
    string location = 2;
    int32 max_match_length = 3;
    optional bool is_hashed = 4;
    repeated DecomposedRegexPart parts = 5;
}

message DecomposedRegexPart {
    optional bool is_public = 1;
    string regex_def = 2;
    optional int32 max_length = 3;
}
